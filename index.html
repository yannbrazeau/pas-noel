<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Le Dernier Convive</title>
<style>
body{
  margin:0; padding:16px;
  background:#0b1020; color:#fff;
  font-family:system-ui;
}
.card{
  max-width:800px; margin:0 auto 16px;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.1);
  border-radius:18px; padding:16px;
}
h1,h2{margin:0 0 10px}
textarea,input,button,select{
  width:100%; padding:12px; border-radius:12px;
  border:none; font-size:16px; margin-top:8px;
}
button{background:#22c55e; color:#062; font-weight:900}
.secondary{background:#38bdf8; color:#023}
.hide{display:none}
.box{margin-top:12px; padding:12px;
  background:rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.1);
  border-radius:14px;
}
.pill{
  display:inline-block; padding:6px 10px;
  border-radius:999px; background:rgba(255,255,255,.08);
  margin:4px 4px 0 0; font-size:13px;
}
</style>
</head>
<body>

<div class="card" id="host">
<h1>ğŸ•¯ï¸ Le Dernier Convive</h1>
<p>Entre exactement <b>9 prÃ©noms</b> (1 par ligne)</p>

<textarea id="names" placeholder="Alice&#10;Bob&#10;Claire&#10;..."></textarea>
<button onclick="generate()">GÃ‰NÃ‰RER LA PARTIE</button>

<div class="box">
<h2>ğŸ”— Liens privÃ©s</h2>
<div id="links">â€”</div>
</div>

<div class="box">
<h2>ğŸ§© Solution (hÃ´te)</h2>
<div id="solution">â€”</div>
</div>
</div>

<div class="card hide" id="player">
<h1>ğŸ•¯ï¸ Le Dernier Convive</h1>
<p><b>DÃ©tective :</b> <span id="pname"></span></p>

<div class="box">
<h2 id="actTitle">ğŸ¥‚ ApÃ©ro</h2>
<p id="story"></p>
</div>

<div class="box">
<h2>ğŸ” Ton indice</h2>
<p id="clue"></p>
</div>

<button class="secondary" onclick="nextAct()">ACTE SUIVANT</button>
</div>

<script>
const ACTS = [
 ["ğŸ¥‚ ApÃ©ro","Quelque chose commence. Un dÃ©tail revient deux fois."],
 ["ğŸ½ï¸ EntrÃ©e","Un objet nâ€™est plus exactement Ã  sa place."],
 ["ğŸ Plat","Quelquâ€™un semble anticiper les rÃ©actions."],
 ["ğŸ§€ Fromage","Un indice est trop parfait."],
 ["ğŸ° Dessert","La vÃ©ritÃ© est lÃ . DÃ©duis."]
];

const WHERE = ["Cuisine","Couloir","Salon","Salle Ã  manger","Terrasse","EntrÃ©e","Escalier","Bar","Point dâ€™eau"];
const HOW = ["Message anonyme","Substitution","Son/LumiÃ¨re","Mensonge","Faux indice","Regard","Rumeur","Disparition","Mise en scÃ¨ne"];

let payload=null, act=0;

function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

function generate(){
  const names=document.getElementById("names").value.trim().split("\n");
  if(names.length!==9){alert("Il faut 9 prÃ©noms");return;}
  const killer=shuffle([...names])[0];
  const where=shuffle([...WHERE])[0];
  const how=shuffle([...HOW])[0];

  document.getElementById("solution").innerHTML=
    `<b>ğŸ”ª ${killer}</b><br>ğŸ“ ${where}<br>ğŸ› ï¸ ${how}`;

  let deck=[];
  names.forEach(n=>{if(n!==killer)deck.push("âŒ Ce nâ€™est pas "+n)});
  WHERE.forEach(l=>{if(l!==where)deck.push("âŒ Pas "+l)});
  HOW.forEach(h=>{if(h!==how)deck.push("âŒ Pas "+h)});
  shuffle(deck);

  let links="";
  names.forEach((n,i)=>{
    const hand=deck.filter((_,k)=>k%9===i);
    const data=btoa(JSON.stringify({n,hand}));
    const url=location.href.split("?")[0]+"?p="+data;
    links+=`<div class="pill">${n}</div><div>${url}</div><br>`;
  });
  document.getElementById("links").innerHTML=links;
}

function loadPlayer(){
  const p=new URLSearchParams(location.search).get("p");
  if(!p)return;
  payload=JSON.parse(atob(p));
  document.getElementById("host").classList.add("hide");
  document.getElementById("player").classList.remove("hide");
  document.getElementById("pname").textContent=payload.n;
  renderAct();
}

function renderAct(){
  document.getElementById("actTitle").textContent=ACTS[act][0];
  document.getElementById("story").textContent=ACTS[act][1];
  document.getElementById("clue").textContent=payload.hand[act]||"Observe.";
}

function nextAct(){
  if(act<4){act++; renderAct();}
  else alert("Fais ton accusation finale.");
}

loadPlayer();
</script>
</body>
</html>

